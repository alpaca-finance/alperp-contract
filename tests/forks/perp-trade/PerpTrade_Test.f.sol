// SPDX-License-Identifier: WTF
pragma solidity 0.8.17;

import {PerpTrade_BaseForkTest} from "./PerpTrade_BaseTest.f.sol";

contract PerpTrade_ForkTest is PerpTrade_BaseForkTest {
  function setUp() public override {
    super.setUp();
  }

  function testCorrectness_WhenTrade() external {
    vm.startPrank(0xF87b564F961b7889fa07f0994197c5229Adf0905);
    bytes memory byteCode = abi.encodePacked(
      vm.getCode(
        string(abi.encodePacked("./out/GetterFacet.sol/GetterFacet.json"))
      )
    );
    address deployed;
    assembly {
      deployed := create(0, add(byteCode, 0x20), mload(byteCode))
    }
    vm.etch(0x85116CAF6279E92aF32a43D6a861e0847e59F97a, deployed.code);

    bytes[] memory priceUpdateData = new bytes[](2);
    priceUpdateData[0] =
      hex"01000000030d00ab728997e3b477bb36958bb089c53dac83fa963d7645abc44be42a47a973887569beba607fafee59b367ae1407592a1a2e3c7f6eae70ad8ec2e060cc4c61b93e01024cbdbba3da1c709c4c3f7c2e7763b5608e241cec0aabc9e07a3a3816f8c439ef365f6b52243a156d90a1139c2bcc9d6bd9faba54f3ab6ccd76a510107838f96501039b1683529a14123850004c766964660a41a499abb7acb896c91fd0775509b7e40d93edd17588ae9269376cb68d0770fe7e6ec3bb2092d42e57c8052f02980d3b00065d2fb3ae352180b152dc5e08eef5dff8352c33593dae6e3410f2820f15fea0794cfb85d76240981293b98991b598b557a961c979022c18de55c311f73ce79b69010806a9e7700df5da9578c3f2ede48203910d0f93acb9e0c2ee901021a5a8768d130704ebe1a194062b645e82ffa13b2dec27ebb3352022d62935b7efe207981547000aa9df6f4a7d18f94866c4ad4d19b3beafaea5cec02e01450eb43dc25fd9d9f8a179d772eff6a44b65240de5274602b2f249f8b2cc7f536ac33f0aa94ef73927a3000b3e6e2ca1341c163625c997ba34918a6729dd4f4ca3ea930534ea2ae95fcee14d559aed02c477906d3c760b49e13a4b24f43c866580683f98c9e48f7d71c6c084010cf2aa6163da6e7af5cafa8f8cf1bfa895399d23223d4ce9936e8de135db8511bd6c87b2dddf22f227088bc2be5e44cefa6fac3a34200317c2d73239cb06f0ce4a010dc9dc0503a5bf8c2506599953eaa0f5ba323215f28ddb740b48f323f3134c462a0c1fa5fdeb18d98d079402bdbbdd14536dcbec9921e6491615fbaab4d2e4f194010e9ccac13dc8cffacbfe0ecb3ca6413d49b2d6ecb2323d58fe03e86c01d3142b8723a74e849ab7e110c036872731b9b679cc41c51cb47b0b6a07ce049c66d2c9b7010fb78d9c2bdda9e6f1043c6e1ca9a1cccea6948feee7c7e239c737dfcec788e7b1466a80cf615f5db1ec56f9aaa568be468f4baef8962e4bd7516a7a85a6e6da75011127959ae50106ccc5cc82a546369508a88028d8fefbdb73e19a4e7c5e00a77746190a9e9f142287350f22e242678fcd0e813d0d33c1defdccf40e987e001a2c7a001222e82279eb7f5f86a89af030e8afb931836cef3eb4aa140a6137572b745c6f14591c444941cac349a49db78d8900bcb4af78e94b408146e5c2deceaca77f43a2006452dbb000000000001af8cd23c2ab91237730770bbea08d61005cdda0984348f3f6eecb559638c0bba00000000017c42d5f0150325748000300010001020005009db0e13ce3260d884b0417c6b4d152d45b2f13991a8592522fad0068a4bce3dfbdf0d57deca57b3da2fe63a493f4c25925fdfd8edf834b20f93e1f84dbd1504d4a0000000000018a62000000000000003efffffff600000000000187960000000000000030010000000700000008000000006452dbb0000000006452dbb0000000006452dbaf0000000000018a62000000000000003e000000006452dbaf8ab03cff1844ab975dcdd1683020c0599fc5392b6f2e12d5dd615bcc2c2e6d08ef0d8b6fda2ceba41da15d4095d1da392a0d2f8ed0c6c7bc0f4cfac8c280b56d000000008443c59000000000001a20acfffffff800000000822d90380000000000192255010000001500000019000000006452dbb0000000006452dbb0000000006452dbaf00000000844363ec0000000000198ca4000000006452dbafc12e5d198c9c673e9ce03265e7d9be69cd6a0c674aabd3d2c41ff5764023e22878d185a741d07edb3412b09008b7c5cfb9bbbd7d568bf00ba737b456ba171501000000001ff073a5000000000003bb3afffffff8000000001fc0efb20000000000047fef010000000c0000000f000000006452dbb0000000006452dbb0000000006452dbaf000000001ff09eee0000000000038ff1000000006452dbaf6bfad3ab2ad6ed59591a5a77cc9b162f8e228e89ef56151b24e15426a2bb4d48eaa020c61cc479712813461ce153894a96a6c00b21ed0cfc2798d1f9a9e9c94a0000000005f5cd780000000000005714fffffff80000000005f5c3c30000000000005e80010000000e00000012000000006452dbb0000000006452dbb0000000006452dbaf0000000005f5cd780000000000005714000000006452dbaf935338f31e783c4e354f3abe1ac0803bf80132862e951e83c61214395daea3962b89b9dc8fdf9f34709a5b106b472f0f39bb6ca9ce04b0fd7f2e971688e2e53b0000000005f667c400000000000066ddfffffff80000000005f65f30000000000000626e010000000f00000014000000006452dbb0000000006452dbb0000000006452dbaf0000000005f667c400000000000066dd000000006452dbaf";
    priceUpdateData[1] =
      hex"01000000030d00d8389b7e31c2a7022f0b9b84b32a9e5344ef1639cda7c9388659f254ba1d7a420b987157328503047adcd774300ea2b70f5ac974da4c172aeec9b17e98c4b39a0102d525062946ef3c146d14afbe6fe2a256503ca609e4be71853c4312e678cfcd560e9848eb9b3ff4a637e6ae449421aabb43ba699e76e4548e536ec1190b73eeee0003df33b250d14f0802a99cd289168c8fd39fcde4d4c8c6f74edd57f5a93f47394a001ac62a2b2d1442ffaeb2e8b8e837167048424e2bcc879a827841f3f021aee4000669333307592b6d3e78a8d56b172f83a592c7dfcc45999249fa3878a50ad7cc053fd0a314063a9d268d2be50672563ba3fbcbf16f99b0901fd26cee3ecedd50f4010819e28bdc6f1aa05e6d197ddfdc7958e4826b550d4a21844e216d36260595129e66380715bb4c347da243602f626b80a7e32648d3767e0359563cc5a391b11c4f010b1d8d7c14d9ab9efd2fdb0011a5e0288a75e2dce10af39e55e7085a417214c94208da4041e9c00396bb85afac331d40817616327f3b8fedb0d5abf803b8680cb6010c578f16f6ab5b9490de63e38ab477337cfde791845909935bf719b165a540b4a20adb93258b1ab99870ca56f54b944bd84c2d6cb3053871748d8c620ef8103472010d9b84c4d89e0b5f7c882855bb958081caa2c98d322f243eacab1e9d3d47b7d4194f03dedb25ed536841932156e5c45f87f6da0abab7e7c7dec3080eee85ae8eb8000e3ee4000e7b6aa12922ece4109e6db378e8b7d21efb87356e1b813a015e0276b6441937bd68da396dbb6a4baa4788303efb332f2136ebad2b2ef99ac6a380d841000fbe7df1b0a98542c61fa7ae92179a8b7f4a29b6dcf94ac509caa4704f84c7a06a0813e72dc6dc9cd9493e05fa30930e8a74c57e05df2f051dd27a5524a30dbd95011099cafcb8d88534c8e9bc5ec15428ea4c0f60a3f65920a80b535bf79b1b73152e6dae597b04d30ba127c1f787e46ea35861d0bdabbff3f2c400eb620649c12a4c00110dc836e0357e5778b6c73335e562eb996e554fb503675c647e3c20f885c494c35b4596270248d0385801ded9445cb9c09180ad6d9d6ab64e084e682199734ed2011223ff9ca50fe9e87fa4d9f508cebc93b5f543b5963bb231fe5982e0e99b2bdcad25d9cbba0bfff2192a8eec173852f63b6ddc87d3706c89a5fffd9b0378c6d26f016452dbb000000000001af8cd23c2ab91237730770bbea08d61005cdda0984348f3f6eecb559638c0bba00000000017c42d660150325748000300010001020005009d04028fba493a357ecde648d51375a445ce1cb9681da1ea11e562b53522a5d3877f981f906d7cfe93f618804f1de89e0199ead306edc022d3230b3e8305f391b00000002c1ca310510000000008743df9fffffff80000002bc30bdbc00000000008d71160010000000600000008000000006452dbb0000000006452dbb0000000006452dbaf0000002c1ca310510000000008743df9000000006452dbafe6c020c1a15366b779a8c870e065023657c88c82b82d58a9fe856896a4034b0415ecddd26d49e1a8f1de9376ebebc03916ede873447c1255d2d5891b92ce57170000002d72c45dc00000000019aa6d4cfffffff80000002d0ec970f80000000017b5e28c010000000500000006000000006452dbb0000000006452dbb0000000006452dbaf0000002d72c45dc00000000019aa6d4c000000006452dbafc67940be40e0cc7ffaa1acb08ee3fab30955a197da1ec297ab133d4d43d86ee6ff61491a931112ddf1bd8147cd1b641375f79f5825126d665480874634fd0ace0000002c409b9be8000000000321447bfffffff80000002be25b0e60000000000370cef501000000130000001c000000006452dbb0000000006452dbb0000000006452dbaf0000002c4152b3a0000000000269fb20000000006452dbaf8d7c0971128e8a4764e757dedb32243ed799571706af3a68ab6a75479ea524ff846ae1bdb6300b817cee5fdee2a6da192775030db5615b94a465f53bd40850b50000001bf6337f9e0000000216934e1efffffff80000001bdd26cac000000000a5a4dee000000000070000000a000000006452dbb0000000006452dbb00000000063a2ccab0000001bf6337f9e0000000216934e1e0000000063a2ccab543b71a4c292744d3fcf814a2ccda6f7c00f283d457f83aa73c41e9defae034ba0255134973f4fdf2f8f7808354274a3b1ebc6ee438be898d045e8b56ba1fe1300000000000000000000000000000000fffffff800000000000000000000000000000000000000000100000006000000006452dbb0000000006447fcd50000000000000000000000000000000000000000000000000000000000000000";

    forkPoolRouter04.decreasePosition{value: 2}(
      0,
      0x55d398326f99059fF775485246999027B3197955,
      0x2170Ed0880ac9A755fd29B2688956BD959F933F8,
      0,
      450000000000000000000000000000000000,
      false,
      0xF87b564F961b7889fa07f0994197c5229Adf0905,
      2800000000000000000000000000000000,
      0x55d398326f99059fF775485246999027B3197955,
      850000000000000000000,
      priceUpdateData
    );

    vm.stopPrank();
  }
}
